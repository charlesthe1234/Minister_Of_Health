<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/" />
    <link rel="stylesheet" href="bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="app.css" />
    <link rel="stylesheet" href="Minister_Of_Time.styles.css" />
    <link rel="icon" type="image/png" href="/images/SmallLogo.png" />
    <HeadOutlet />
</head>

<body>
    <Routes />
    <script src="_framework/blazor.web.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Catch all 4 arguments: Pie labels, Pie values, Line labels, Line values
        window.renderLifeCharts = (pieLabels, pieValues, lineLabels, lineValues) => {

            console.log("Pie Data:", pieLabels, pieValues);
            console.log("Line Data:", lineLabels, lineValues);

            // --- LINE CHART ---
            const lineCtx = document.getElementById('lifeLineChart');
            if (lineCtx) {
                try {
                    let existingLine = Chart.getChart("lifeLineChart");
                    if (existingLine) existingLine.destroy();

                    const colors = ['#FFD700', '#00d2ff', '#FF6384', '#4BC0C0', '#9966FF'];

                    new Chart(lineCtx, {
                        type: 'line',
                        data: {
                            labels: lineLabels, // Now correctly linked to the 3rd argument
                            datasets: lineValues.map((item, index) => ({
                                label: item.label,
                                data: item.data,
                                borderColor: colors[index % colors.length],
                                backgroundColor: 'transparent',
                                tension: 0.4,
                                fill: false
                            }))
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: { labels: { color: 'white' } }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: { color: 'white', callback: v => v + 'h' }
                                },
                                x: { ticks: { color: 'white' } }
                            }
                        }
                    });
                } catch (err) {
                    console.error("Line Chart Error:", err);
                }
            }

            // --- PIE CHART ---
            const pieCtx = document.getElementById('lifePieChart');
            if (pieCtx) {
                try {
                    let existingPie = Chart.getChart("lifePieChart");
                    if (existingPie) existingPie.destroy();

                    new Chart(pieCtx, {
                        type: 'pie',
                        data: {
                            labels: pieLabels, // Linked to 1st argument
                            datasets: [{
                                data: pieValues, // Linked to 2nd argument
                                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40']
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: { position: 'bottom', labels: { color: 'white' } },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            let totalMinutes = context.parsed;
                                            let hours = Math.floor(totalMinutes / 60);
                                            let mins = Math.round(totalMinutes % 60);
                                            return context.label + ': ' +
                                                   hours.toString().padStart(2, '0') + 'h ' +
                                                   mins.toString().padStart(2, '0') + 'm';
                                        }
                                    }
                                }
                            }
                        }
                    });
                } catch (err) {
                    console.error("Pie Chart Error:", err);
                }
            }
        };
    </script>
</body>

</html>
